---
number: 30
title: SSE 연결이 즉시 끊어지며 페이지가 무한 새로고침됨
state: done
labels:
    - bug
    - serve
assignees: []
created_at: 2026-01-18T19:03:18.315581+09:00
updated_at: 2026-01-18T19:06:01.298242+09:00
closed_at: 2026-01-18T19:06:01.298243+09:00
---

## 증상

`zap serve -D` 명령으로 서버를 띄우고 웹페이지에 접속하면:
1. SSE client가 연결됨
2. 약 100ms 후 SSE client가 즉시 끊어짐
3. 페이지가 새로고침됨
4. 위 과정이 무한 반복

## 로그 예시

```
SSE client connected (total: 1)
SSE client disconnected (total: 0)
[55] GET /events 200 103.009959ms [SSE clients: 0]
[56] GET / 200 13.903ms
```

## 원인 분석

`zap serve -D` (데몬 모드)가 로그를 `.issues/.zap-serve.log`에 기록하는데, fsnotify가 `.issues/` 디렉토리 전체를 감시하고 있어서:

1. 서버 로그가 `.zap-serve.log`에 기록됨
2. fsnotify가 파일 변경 감지
3. 100ms debounce 후 "reload" 메시지 브로드캐스트
4. 클라이언트가 `location.reload()` 실행
5. 새로운 로그 발생 → 1번으로 돌아감 (무한 루프)

## 해결

`internal/web/server.go`의 `watchFiles()` 함수에서 파일 필터링 추가:

- 숨김 파일(`.`으로 시작하는 파일) 무시
- 이슈 파일 확장자(`.md`, `.rst`)만 감시

```go
isIssueFile := strings.HasSuffix(filename, ".md") || strings.HasSuffix(filename, ".rst")
if !strings.HasPrefix(filename, ".") && isIssueFile {
    debounce.Reset(100 * time.Millisecond)
}
```
